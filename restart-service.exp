#!/usr/bin/expect -f

set timeout 30
set remote_host "10.102.32.144"
set remote_user "lab426"
set remote_pass "426"

puts "ğŸ”„ é‡æ–°å¯åŠ¨æœåŠ¡..."

spawn ssh -o StrictHostKeyChecking=no ${remote_user}@${remote_host}
expect {
    "password:" {
        send "${remote_pass}\r"
    }
}

expect "$ " {
    send "cd ~/aigc-security-platform\r"
}

expect "$ " {
    send "ls -la\r"
}

expect "$ " {
    send "tmux kill-session -t aigc-security 2>/dev/null; echo 'Killed old session'\r"
}

expect "$ " {
    send "tmux new-session -d -s aigc-security 'http-server . -p 5670 -a 0.0.0.0'\r"
}

expect "$ " {
    send "sleep 2\r"
}

expect "$ " {
    send "tmux ls\r"
}

expect "$ " {
    send "netstat -tlnp | grep 5670 || ss -tlnp | grep 5670\r"
}

expect "$ " {
    send "curl -s http://localhost:5670 | head -10\r"
}

expect "$ " {
    send "echo '\\nâœ… æœåŠ¡çŠ¶æ€æ£€æŸ¥å®Œæˆ'\r"
}

expect "$ " {
    send "exit\r"
}

expect eof

puts "\nğŸ“ æç¤º: å¦‚éœ€æŸ¥çœ‹tmuxä¼šè¯ï¼Œè¿è¡Œ: ssh lab426@10.102.32.144 'tmux attach -t aigc-security'"



